# Система подбора сотрудников для клиентов

## Описание
Система предназначена для эффективного подбора сотрудников для работы с клиентами на основе их стрессоустойчивости, истории коммуникаций и предпочтений клиентов.

## Основные возможности

### Для администраторов
- Создание и управление учетными записями сотрудников
- Назначение групп сотрудникам (normal, slightly_below, significantly_below)
- Создание и управление тестами для оценки сотрудников
- Просмотр статистики и результатов тестов

### Для сотрудников
- Прохождение различных типов тестов (аудио, видео, анкеты, тесты с вариантами ответов)
- Просмотр своей истории коммуникаций с клиентами
- Получение обратной связи от клиентов
- Отслеживание своего уровня стрессоустойчивости

### Для клиентов
- Выбор предпочтительных сотрудников
- Оценка качества коммуникаций
- Получение автоматического подбора наиболее подходящего сотрудника

## Установка и запуск

### Требования
- Python 3.8+
- PostgreSQL 12+
- FastAPI
- SQLAlchemy
- JWT для аутентификации

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Настройка базы данных
1. Создайте базу данных PostgreSQL
2. Настройте переменные окружения:
```bash
export DATABASE_URL="postgresql://user:password@localhost/dbname"
export SECRET_KEY="your-secret-key"
```

### Запуск приложения
```bash
uvicorn app.main:app --reload
```

## Первый запуск

1. Создайте первого суперпользователя:
```bash
curl -X POST "http://localhost:8000/first-superuser/" \
     -H "Content-Type: application/json" \
     -d '{"name": "admin", "password": "admin_password", "stress_level": 0.5, "group": "normal"}'
```

2. Получите токен доступа:
```bash
curl -X POST "http://localhost:8000/token" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=admin&password=admin_password"
```

## Использование API

### Аутентификация
Все запросы к API (кроме создания первого суперпользователя и получения токена) требуют JWT аутентификации. 
Токен должен передаваться в заголовке:
```
Authorization: Bearer your-token-here
```

### Основные эндпоинты

#### Сотрудники
- `POST /employees/` - создание нового сотрудника
- `GET /employees/` - получение списка сотрудников
- `GET /employees/me/` - информация о текущем сотруднике
- `PUT /employees/{id}/group` - изменение группы сотрудника

#### Клиенты
- `POST /clients/` - создание нового клиента
- `GET /clients/` - получение списка клиентов
- `GET /clients/{id}/preferred-employees` - получение предпочтительных сотрудников
- `POST /clients/{id}/preferred-employees/{employee_id}` - добавление предпочтительного сотрудника
- `DELETE /clients/{id}/preferred-employees/{employee_id}` - удаление предпочтительного сотрудника

#### Коммуникации
- `POST /communications/` - создание новой коммуникации
- `GET /communications/` - получение списка коммуникаций
- `PUT /communications/{id}` - обновление информации о коммуникации

#### Тесты
- `POST /tests/audio/{employee_id}` - загрузка аудио-теста
- `POST /tests/video/{employee_id}` - загрузка видео-теста
- `POST /tests/questionnaire/{employee_id}` - отправка анкеты
- `POST /tests/multiple-choice/` - создание теста с вариантами ответов
- `GET /tests/multiple-choice/` - получение списка тестов
- `POST /tests/multiple-choice/{id}/submit` - отправка ответов на тест

#### Подбор сотрудника
- `GET /match/{client_id}` - подбор сотрудника для клиента

## Безопасность

1. Все пароли хешируются с использованием bcrypt
2. JWT токены имеют ограниченный срок действия (30 минут)
3. Доступ к определенным операциям ограничен ролями пользователей
4. Все данные передаются по HTTPS

## Мониторинг и логирование

Система ведет логи следующих событий:
- Аутентификация пользователей
- Создание и изменение коммуникаций
- Результаты тестов
- Изменения групп сотрудников

## Обработка ошибок

Система возвращает понятные сообщения об ошибках с соответствующими HTTP-кодами:
- 400: Неверный запрос
- 401: Не авторизован
- 403: Нет доступа
- 404: Ресурс не найден
- 500: Внутренняя ошибка сервера

## Примеры использования

### Создание сотрудника
```python
import requests

response = requests.post(
    "http://localhost:8000/employees/",
    json={
        "name": "Иван Иванов",
        "password": "secure_password",
        "stress_level": 0.5,
        "group": "normal"
    },
    headers={"Authorization": f"Bearer {token}"}
)
```

### Создание коммуникации
```python
response = requests.post(
    "http://localhost:8000/communications/",
    json={
        "client_id": 1,
        "employee_id": 1,
        "duration": 300,
        "success_rate": 0.8,
        "call_type": "outgoing",
        "status": "completed",
        "notes": "Успешный звонок",
        "tags": ["продажа", "консультация"]
    },
    headers={"Authorization": f"Bearer {token}"}
)
```

### Подбор сотрудника
```python
response = requests.get(
    "http://localhost:8000/match/1",
    headers={"Authorization": f"Bearer {token}"}
)
```
## Фронтенд

### Страницы для администраторов

1. **Панель управления**
   - Общая статистика
   - Графики эффективности сотрудников
   - Мониторинг активных коммуникаций
   - Уведомления о критических ситуациях

2. **Управление сотрудниками**
   - Список всех сотрудников
   - Фильтрация по группам и статусу
   - Добавление/редактирование сотрудников
   - Просмотр истории тестов и коммуникаций

3. **Управление тестами**
   - Создание новых тестов
   - Редактирование существующих тестов
   - Просмотр результатов тестов
   - Аналитика по результатам

4. **Настройки системы**
   - Конфигурация параметров подбора
   - Настройка уведомлений
   - Управление правами доступа
   - Настройка интеграций

### Страницы для сотрудников

1. **Личный кабинет**
   - Профиль сотрудника
   - Текущий уровень стрессоустойчивости
   - История коммуникаций
   - Обратная связь от клиентов

2. **Тесты**
   - Список доступных тестов
   - Прохождение тестов
   - Результаты пройденных тестов
   - Рекомендации по улучшению

3. **Коммуникации**
   - Активные коммуникации
   - История звонков
   - Заметки по клиентам
   - Оценки качества

### Страницы для клиентов

1. **Личный кабинет клиента**
   - Профиль клиента
   - История коммуникаций
   - Предпочтительные сотрудники
   - Оценки качества обслуживания

2. **Обратная связь**
   - Форма оценки коммуникации
   - Жалобы и предложения
   - Выбор предпочтительных сотрудников
   - Блокировка нежелательных сотрудников

### Общие элементы

1. **Аутентификация**
   - Страница входа
   - Восстановление пароля
   - Двухфакторная аутентификация
   - Управление сессиями

2. **Уведомления**
   - Система уведомлений
   - Настройка оповещений
   - История уведомлений
   - Приоритизация сообщений

3. **Поиск и фильтрация**
   - Поиск по всем разделам
   - Расширенные фильтры
   - Сохранение поисковых запросов
   - Экспорт результатов

### Технические требования

1. **Фреймворки и библиотеки**
   - React/Vue.js для UI
   - Redux/Vuex для управления состоянием
   - Material-UI/Ant Design для компонентов
   - Axios для API-запросов

2. **Безопасность**
   - JWT аутентификация
   - HTTPS
   - Защита от XSS и CSRF
   - Валидация форм

3. **Производительность**
   - Оптимизация загрузки
   - Кэширование данных
   - Ленивая загрузка компонентов
   - Оптимизация изображений

4. **Адаптивность**
   - Мобильная версия
   - Адаптивный дизайн
   - Поддержка различных устройств
   - Оптимизация для планшетов 
