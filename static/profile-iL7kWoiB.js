import{d as N,e as k,g as oe,f as re}from"./index-CIpMSW_s.js";import{V as $,a as j,b as w}from"./VCard-BaakkVFD.js";import{V as x}from"./VBtn-B-hdhH-1.js";import{f,h as E,g as ue}from"./VAvatar-C-ER2-0S.js";import{V as C}from"./VDivider-Drx-iRHJ.js";import{V as ne}from"./VForm-D0rJnxSg.js";import{V as D}from"./VTextField-BhM9EnZB.js";import{V as y}from"./VChip-pvFqXEpf.js";import{V as ie,a as R,b as de,c as A}from"./VTabs-Cq3JusBa.js";import{V as G,a as W,b as K,c as O}from"./VList-zMJOwsiP.js";import{V as me}from"./VSnackbar-X6915U30.js";import{f as q,d as i,c as ce,x as fe,K as d,L as u,M as t,m as l,O as m,S as o,T as r,R as M,V as g,F as T,U as H}from"./vue-vendor-B4qzxTjV.js";import"./vuetify-vendor-BD37EBPT.js";import"./VInput-Bp3p24Ap.js";import"./index-yNQZhi3p.js";import"./forwardRefs-C-GTDzx5.js";import"./VField-BmVeynRq.js";import"./lazy-UP9naqc7.js";import"./VOverlay-BXO8EOEs.js";const pe={class:"d-flex justify-space-between align-center my-2"},ve={class:"text-body-1"},ye={class:"d-flex align-center mb-2"},ge={class:"text-body-1 mb-4"},Ve={class:"text-body-2 mt-2"},Ee={__name:"profile",setup(_e){const J=q("employees");q("communications");const n=i({id:0,name:"",email:"",is_active:!0,is_superuser:!1,group:"normal",stress_level:1}),v=i(""),U=i(""),S=i([]),z=i([]),L=i(!0),P=i(!1),c=i(!1),V=i("tests"),F=i(null),p=i(!1),_=i(""),b=i("success"),Q=ce(()=>I(new Date)),X=async()=>{L.value=!0;try{const s=await J.getProfile();n.value=s.data,S.value=[{test_type:"Психологический тест",score:85,timestamp:new Date-864e5*3},{test_type:"Тест на коммуникативность",score:92,timestamp:new Date-864e5*10},{test_type:"Оценка стрессоустойчивости",score:78,timestamp:new Date-864e5*20}],z.value=[{id:1,client_id:101,call_type:"Телефон",status:"completed",timestamp:new Date-864e5,duration:420,success_rate:95},{id:2,client_id:102,call_type:"Чат",status:"in_progress",timestamp:new Date-864e5*2,duration:null,success_rate:null},{id:3,client_id:103,call_type:"Email",status:"canceled",timestamp:new Date-864e5*5,duration:180,success_rate:40}]}catch(s){console.error("Ошибка загрузки данных профиля:",s),b.value="error",_.value="Ошибка загрузки данных профиля",p.value=!0}finally{L.value=!1}},Y=async()=>{if(F.value.validate()){P.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),c.value=!1,v.value="",U.value="",b.value="success",_.value="Профиль успешно обновлен",p.value=!0}catch(s){console.error("Ошибка сохранения профиля:",s),b.value="error",_.value="Ошибка сохранения профиля",p.value=!0}finally{P.value=!1}}};function I(s){return(s instanceof Date?s:new Date(s)).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function Z(s){const e=Math.floor(s/60),a=s%60;return`${e}:${a.toString().padStart(2,"0")}`}function h(s){return{1:"success",2:"light-green",3:"warning",4:"orange",5:"error"}[s]||"grey"}function ee(s){return{1:"Нормальный уровень стресса",2:"Незначительный стресс",3:"Средний уровень стресса",4:"Повышенный уровень стресса",5:"Критический уровень стресса"}[s]||"Неизвестный уровень стресса"}function te(s){return{normal:"Норма",slightly_below:"Чуть ниже нормы",significantly_below:"Значительно ниже нормы"}[s]||"Неизвестная группа"}function le(s){return{normal:"success",slightly_below:"warning",significantly_below:"error"}[s]||"grey"}function ae(s){return{completed:"success",in_progress:"info",scheduled:"primary",canceled:"error",pending:"warning"}[s]||"grey"}function se(s){return{completed:"mdi-check-circle",in_progress:"mdi-progress-clock",scheduled:"mdi-calendar-clock",canceled:"mdi-cancel",pending:"mdi-clock-outline"}[s]||"mdi-help-circle"}return fe(()=>{X()}),(s,e)=>(u(),d(re,{fluid:""},{default:t(()=>[l(N,null,{default:t(()=>[l(k,{cols:"12",class:"mb-4"},{default:t(()=>e[9]||(e[9]=[m("h1",{class:"text-h4"},"Профиль сотрудника",-1)])),_:1})]),_:1}),L.value?(u(),d(N,{key:0},{default:t(()=>[l(k,{cols:"12",class:"text-center"},{default:t(()=>[l(oe,{indeterminate:"",color:"primary",size:"64"}),e[10]||(e[10]=m("div",{class:"mt-4"},"Загрузка данных профиля...",-1))]),_:1})]),_:1})):(u(),d(N,{key:1},{default:t(()=>[l(k,{cols:"12",md:"4"},{default:t(()=>[l($,{class:"mb-4"},{default:t(()=>[l(j,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[11]||(e[11]=m("span",null,"Персональные данные",-1)),l(x,{icon:"",variant:"text",onClick:e[0]||(e[0]=a=>c.value=!c.value),color:c.value?"success":"secondary"},{default:t(()=>[l(f,null,{default:t(()=>[o(r(c.value?"mdi-check":"mdi-pencil"),1)]),_:1})]),_:1},8,["color"])]),_:1}),l(C),l(w,null,{default:t(()=>[l(E,{size:"120",color:"primary",class:"mb-4 mx-auto d-block"},{default:t(()=>[l(f,{size:"64",dark:""},{default:t(()=>e[12]||(e[12]=[o("mdi-account")])),_:1})]),_:1}),l(ne,{ref_key:"form",ref:F},{default:t(()=>[l(D,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.name=a),label:"Имя",readonly:!c.value,variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue","readonly"]),l(D,{modelValue:n.value.email,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.email=a),label:"Email",readonly:!c.value,variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue","readonly"]),c.value?(u(),M(T,{key:0},[l(D,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),label:"Новый пароль",type:"password",hint:"Оставьте пустым, если не хотите менять",variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue"]),l(D,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=a=>U.value=a),label:"Подтвердите пароль",type:"password",rules:[a=>!v.value||a===v.value||"Пароли должны совпадать"],variant:"outlined",density:"comfortable",class:"mb-2"},null,8,["modelValue","rules"])],64)):g("",!0),m("div",pe,[e[13]||(e[13]=m("div",{class:"text-subtitle-1"},"ID сотрудника",-1)),m("div",ve,r(n.value.id),1)]),l(C,{class:"my-4"}),m("div",ye,[l(y,{label:"",color:n.value.is_active?"success":"error",class:"mr-2"},{default:t(()=>[o(r(n.value.is_active?"Активен":"Неактивен"),1)]),_:1},8,["color"]),n.value.is_superuser?(u(),d(y,{key:0,label:"",color:"info"},{default:t(()=>e[14]||(e[14]=[o(" Администратор ")])),_:1})):g("",!0)]),c.value?(u(),d(x,{key:1,color:"primary",block:"",class:"mt-4",onClick:Y,loading:P.value},{default:t(()=>e[15]||(e[15]=[o(" Сохранить изменения ")])),_:1},8,["loading"])):g("",!0)]),_:1},512)]),_:1})]),_:1}),l($,null,{default:t(()=>[l(j,null,{default:t(()=>e[16]||(e[16]=[o("Уровень стресса")])),_:1}),l(C),l(w,{class:"text-center py-4"},{default:t(()=>[l(ue,{"model-value":n.value.stress_level*20,color:h(n.value.stress_level),height:"25",rounded:"",class:"mb-3"},{default:t(()=>[m("strong",null,r(n.value.stress_level)+"/5",1)]),_:1},8,["model-value","color"]),m("div",ge,r(ee(n.value.stress_level)),1),l(y,{color:le(n.value.group),class:"mb-3"},{default:t(()=>[o(" Группа: "+r(te(n.value.group)),1)]),_:1},8,["color"]),m("div",Ve," Последнее обновление: "+r(Q.value),1)]),_:1})]),_:1})]),_:1}),l(k,{cols:"12",md:"8"},{default:t(()=>[l($,{class:"mb-4"},{default:t(()=>[l(ie,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a)},{default:t(()=>[l(R,{value:"tests"},{default:t(()=>[l(f,{start:""},{default:t(()=>e[17]||(e[17]=[o("mdi-clipboard-text")])),_:1}),e[18]||(e[18]=o(" Тесты "))]),_:1}),l(R,{value:"communications"},{default:t(()=>[l(f,{start:""},{default:t(()=>e[19]||(e[19]=[o("mdi-message-text")])),_:1}),e[20]||(e[20]=o(" Коммуникации "))]),_:1})]),_:1},8,["modelValue"]),l(C),l(de,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value=a)},{default:t(()=>[l(A,{value:"tests"},{default:t(()=>[S.value.length===0?(u(),d(w,{key:0,class:"text-center py-4"},{default:t(()=>[l(f,{size:"large",color:"grey"},{default:t(()=>e[21]||(e[21]=[o("mdi-test-tube")])),_:1}),e[23]||(e[23]=m("div",{class:"mt-2 text-medium-emphasis"},"Нет пройденных тестов",-1)),l(x,{color:"primary",variant:"text",class:"mt-4",to:"/tests"},{default:t(()=>e[22]||(e[22]=[o(" Пройти тест ")])),_:1})]),_:1})):(u(),d(G,{key:1},{default:t(()=>[(u(!0),M(T,null,H(S.value,(a,B)=>(u(),d(W,{key:B},{append:t(()=>[l(y,{color:a.score>=70?"success":a.score>=40?"warning":"error",size:"small",class:"ms-2"},{default:t(()=>[o(r(a.score)+"% ",1)]),_:2},1032,["color"])]),default:t(()=>[l(K,null,{default:t(()=>[o(r(a.test_type),1)]),_:2},1024),l(O,null,{default:t(()=>[o(" Результат: "+r(a.score)+"% • "+r(I(a.timestamp)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1}),l(A,{value:"communications"},{default:t(()=>[z.value.length===0?(u(),d(w,{key:0,class:"text-center py-4"},{default:t(()=>[l(f,{size:"large",color:"grey"},{default:t(()=>e[24]||(e[24]=[o("mdi-message-text-outline")])),_:1}),e[25]||(e[25]=m("div",{class:"mt-2 text-medium-emphasis"},"Нет записей о коммуникациях",-1))]),_:1})):(u(),d(G,{key:1},{default:t(()=>[(u(!0),M(T,null,H(z.value,(a,B)=>(u(),d(W,{key:B,to:`/communications/${a.id}`},{prepend:t(()=>[l(E,{size:"40",color:ae(a.status),class:"mr-3"},{default:t(()=>[l(f,{dark:""},{default:t(()=>[o(r(se(a.status)),1)]),_:2},1024)]),_:2},1032,["color"])]),append:t(()=>[a.success_rate!==null?(u(),d(y,{key:0,color:a.success_rate>=70?"success":a.success_rate>=40?"warning":"error",size:"small",class:"ms-2"},{default:t(()=>[o(r(a.success_rate)+"% ",1)]),_:2},1032,["color"])):g("",!0)]),default:t(()=>[l(K,null,{default:t(()=>[o(" Клиент #"+r(a.client_id)+" • "+r(a.call_type),1)]),_:2},1024),l(O,null,{default:t(()=>[o(r(I(a.timestamp))+" • "+r(a.status)+" ",1),a.duration?(u(),M(T,{key:0},[o(" • "+r(Z(a.duration)),1)],64)):g("",!0)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1}))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})),l(me,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),color:b.value,timeout:3e3},{actions:t(()=>[l(x,{variant:"text",onClick:e[7]||(e[7]=a=>p.value=!1)},{default:t(()=>e[26]||(e[26]=[o("Закрыть")])),_:1})]),default:t(()=>[o(r(_.value)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}};export{Ee as default};
