import{f as ve,Q as _e,d as _,c as C,x as ge,w as ye,K as V,L as m,M as e,m as l,O as n,S as i,R as h,V as G,F as $,U as j,T as u,Z as H}from"./vue-vendor-B4qzxTjV.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as M,e as f,g as xe,f as we}from"./index-CIpMSW_s.js";import{V as S,b as P,c as Ce,a as q}from"./VCard-BaakkVFD.js";import{V as he}from"./VTextField-BhM9EnZB.js";import{V as B}from"./VSelect-DqaGkUWA.js";import{V as I}from"./VBtn-B-hdhH-1.js";import{V as De,a as ke}from"./VTable-4JWyy6tp.js";import{h as D,g as be,f as g}from"./VAvatar-C-ER2-0S.js";import{V as J}from"./VChip-pvFqXEpf.js";import{V as ze}from"./VDivider-Drx-iRHJ.js";import{V as W}from"./VSpacer-CKNG9Jdn.js";import{V as E,a as T,b as U}from"./VList-zMJOwsiP.js";import{V as Me}from"./VSnackbar-X6915U30.js";import"./vuetify-vendor-BD37EBPT.js";import"./VField-BmVeynRq.js";import"./index-yNQZhi3p.js";import"./VInput-Bp3p24Ap.js";import"./forwardRefs-C-GTDzx5.js";import"./VMenu-BWniRe4g.js";import"./VOverlay-BXO8EOEs.js";import"./lazy-UP9naqc7.js";import"./dialog-transition-MjUo7Nu_.js";import"./VCheckboxBtn-CvAPjEFh.js";import"./VSelectionControl-b5nrjLPm.js";const Se=["onClick"],Pe={class:"d-flex align-center"},Ie={class:"text-caption text-center mt-1"},Te={key:1,class:"text-center py-5"},Ue={class:"text-caption text-medium-emphasis"},Le={class:"d-flex align-center"},Re={class:"text-caption text-medium-emphasis ms-2"},Fe={class:"d-flex align-center"},$e={class:"text-caption text-medium-emphasis ms-2"},Be={class:"d-flex align-center"},Ne={class:"d-flex align-center"},Oe={class:"d-flex align-center"},je={__name:"index",setup(qe){ve("communications");const X=_e(),N=_(!0),k=_([]),b=_(""),x=_(!1),L=_(""),R=_("success"),c=_({status:"all",type:"all",date:"all"}),p=_({page:1,itemsPerPage:10}),ee=[{title:"Все статусы",value:"all"},{title:"Завершен",value:"completed"},{title:"В процессе",value:"in_progress"},{title:"Запланирован",value:"scheduled"},{title:"Отменен",value:"canceled"},{title:"Ожидает",value:"pending"}],te=[{title:"Все типы",value:"all"},{title:"Телефон",value:"phone"},{title:"Чат",value:"chat"},{title:"Email",value:"email"},{title:"Видео",value:"video"}],le=[{title:"Все время",value:"all"},{title:"Сегодня",value:"today"},{title:"Вчера",value:"yesterday"},{title:"Последние 7 дней",value:"week"},{title:"Последние 30 дней",value:"month"}],ae=async()=>{N.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),k.value=[{id:1,client_id:101,client_name:"Иван Петров",call_type:"phone",status:"completed",timestamp:new Date-864e5*1,duration:420,success_rate:95},{id:2,client_id:102,client_name:"Мария Иванова",call_type:"chat",status:"in_progress",timestamp:new Date-864e5*.5,duration:null,success_rate:null},{id:3,client_id:103,client_name:"Алексей Смирнов",call_type:"email",status:"canceled",timestamp:new Date-864e5*3,duration:180,success_rate:40},{id:4,client_id:104,client_name:"Елена Кузнецова",call_type:"video",status:"scheduled",timestamp:new Date+864e5*1,duration:null,success_rate:null},{id:5,client_id:101,client_name:"Иван Петров",call_type:"phone",status:"completed",timestamp:new Date-864e5*5,duration:350,success_rate:85},{id:6,client_id:105,client_name:"Ольга Морозова",call_type:"chat",status:"completed",timestamp:new Date-864e5*2,duration:600,success_rate:80},{id:7,client_id:106,client_name:"Сергей Козлов",call_type:"email",status:"pending",timestamp:new Date-864e5*1.5,duration:null,success_rate:null},{id:8,client_id:107,client_name:"Татьяна Новикова",call_type:"phone",status:"completed",timestamp:new Date-864e5*6,duration:480,success_rate:70},{id:9,client_id:108,client_name:"Дмитрий Соколов",call_type:"video",status:"completed",timestamp:new Date-864e5*4,duration:720,success_rate:90},{id:10,client_id:109,client_name:"Анна Попова",call_type:"chat",status:"in_progress",timestamp:new Date-864e5*.2,duration:null,success_rate:null}],p.value.page=1}catch(a){console.error("Ошибка загрузки коммуникаций:",a),R.value="error",L.value="Ошибка загрузки данных",x.value=!0}finally{N.value=!1}},v=C(()=>{let a=[...k.value];c.value.status!=="all"&&(a=a.filter(r=>r.status===c.value.status)),c.value.type!=="all"&&(a=a.filter(r=>r.call_type===c.value.type));const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),o=new Date(s);o.setDate(o.getDate()-1);const w=new Date(s);w.setDate(w.getDate()-7);const y=new Date(s);if(y.setDate(y.getDate()-30),c.value.date!=="all")switch(c.value.date){case"today":a=a.filter(r=>new Date(r.timestamp)>=s);break;case"yesterday":a=a.filter(r=>{const d=new Date(r.timestamp);return d>=o&&d<s});break;case"week":a=a.filter(r=>new Date(r.timestamp)>=w);break;case"month":a=a.filter(r=>new Date(r.timestamp)>=y);break}if(b.value){const r=b.value.toLowerCase();a=a.filter(d=>d.client_name.toLowerCase().includes(r)||d.client_id.toString().includes(r)||d.id.toString().includes(r))}return a}),se=C(()=>Math.ceil(v.value.length/p.value.itemsPerPage)),O=C(()=>(p.value.page-1)*p.value.itemsPerPage),A=C(()=>{const a=O.value+p.value.itemsPerPage;return a>v.value.length?v.value.length:a}),ne=C(()=>v.value.slice(O.value,A.value)),z=C(()=>{const a={},t={};let s=0,o=0,w=0,y=0;const r=new Set;return k.value.forEach(d=>{a[d.call_type]=(a[d.call_type]||0)+1,t[d.status]=(t[d.status]||0)+1,d.success_rate!==null&&d.success_rate!==void 0&&(s+=d.success_rate,o++),d.duration&&(w+=d.duration,y++),r.add(d.client_id)}),{typeCounts:a,statusCounts:t,averageSuccessRate:o>0?s/o:0,averageDuration:y>0?w/y:0,uniqueClients:r.size}}),F=()=>{p.value.page=1},ie=()=>{b.value="",c.value={status:"all",type:"all",date:"all"},p.value.page=1},Q=a=>{X.push(`/communications/${a}`)},ue=a=>{R.value="success",L.value="Экспорт коммуникации #"+a+" начат",x.value=!0},oe=()=>{R.value="success",L.value="Экспорт данных начат",x.value=!0};function re(a){return new Date(a).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function de(a){if(!a)return"0:00";const t=Math.floor(a/60),s=a%60;return`${t}:${s.toString().padStart(2,"0")}`}function ce(a){return a?a.split(" ").map(t=>t[0]).join("").toUpperCase():""}function K(a){return{completed:"success",in_progress:"info",scheduled:"primary",canceled:"error",pending:"warning"}[a]||"grey"}function me(a){return{completed:"mdi-check-circle",in_progress:"mdi-progress-clock",scheduled:"mdi-calendar-clock",canceled:"mdi-cancel",pending:"mdi-clock-outline"}[a]||"mdi-help-circle"}function Y(a){return{completed:"Завершен",in_progress:"В процессе",scheduled:"Запланирован",canceled:"Отменен",pending:"Ожидает"}[a]||a}function Z(a){return{phone:"indigo",chat:"cyan",email:"amber",video:"deep-purple"}[a]||"grey"}function pe(a){return{phone:"mdi-phone",chat:"mdi-chat",email:"mdi-email",video:"mdi-video"}[a]||"mdi-help-circle"}function fe(a){return a==null?"grey":a>=80?"success":a>=60?"warning":"error"}return ge(()=>{ae()}),ye(p,()=>{},{deep:!0}),(a,t)=>(m(),V(we,{fluid:""},{default:e(()=>[l(M,null,{default:e(()=>[l(f,{cols:"12",class:"mb-4"},{default:e(()=>t[8]||(t[8]=[n("h1",{class:"text-h4"},"Коммуникации",-1),n("p",{class:"text-subtitle-1 mt-2"}," История взаимодействий с клиентами ",-1)])),_:1})]),_:1}),l(M,null,{default:e(()=>[l(f,{cols:"12"},{default:e(()=>[l(S,{class:"mb-4"},{default:e(()=>[l(P,null,{default:e(()=>[l(M,null,{default:e(()=>[l(f,{cols:"12",sm:"4"},{default:e(()=>[l(he,{modelValue:b.value,"onUpdate:modelValue":[t[0]||(t[0]=s=>b.value=s),F],label:"Поиск",placeholder:"Поиск по имени клиента, ID...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",class:"mb-3 mb-sm-0"},null,8,["modelValue"])]),_:1}),l(f,{cols:"6",sm:"2"},{default:e(()=>[l(B,{modelValue:c.value.status,"onUpdate:modelValue":[t[1]||(t[1]=s=>c.value.status=s),F],label:"Статус",items:ee,variant:"outlined",density:"comfortable","hide-details":"",class:"mb-3 mb-sm-0"},null,8,["modelValue"])]),_:1}),l(f,{cols:"6",sm:"2"},{default:e(()=>[l(B,{modelValue:c.value.type,"onUpdate:modelValue":[t[2]||(t[2]=s=>c.value.type=s),F],label:"Тип",items:te,variant:"outlined",density:"comfortable","hide-details":"",class:"mb-3 mb-sm-0"},null,8,["modelValue"])]),_:1}),l(f,{cols:"6",sm:"2"},{default:e(()=>[l(B,{modelValue:c.value.date,"onUpdate:modelValue":[t[3]||(t[3]=s=>c.value.date=s),F],label:"Период",items:le,variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"])]),_:1}),l(f,{cols:"6",sm:"2",class:"d-flex justify-end align-center"},{default:e(()=>[l(I,{color:"secondary",variant:"text",onClick:ie},{default:e(()=>t[9]||(t[9]=[i(" Сбросить ")])),_:1}),l(I,{color:"primary",class:"ms-2","prepend-icon":"mdi-export",onClick:oe},{default:e(()=>t[10]||(t[10]=[i(" Экспорт ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(M,null,{default:e(()=>[l(f,{cols:"12"},{default:e(()=>[l(S,null,{default:e(()=>[N.value?(m(),V(P,{key:0,class:"text-center py-5"},{default:e(()=>[l(xe,{indeterminate:"",color:"primary",size:"64"}),t[11]||(t[11]=n("div",{class:"mt-4"},"Загрузка данных...",-1))]),_:1})):(m(),h($,{key:1},[v.value.length>0?(m(),V(De,{key:0},{default:e(()=>[t[14]||(t[14]=n("thead",null,[n("tr",null,[n("th",null,"ID"),n("th",null,"Клиент"),n("th",null,"Тип"),n("th",null,"Дата"),n("th",null,"Статус"),n("th",null,"Успешность"),n("th",null,"Действия")])],-1)),n("tbody",null,[(m(!0),h($,null,j(ne.value,s=>(m(),h("tr",{key:s.id,class:"communication-row",onClick:o=>Q(s.id)},[n("td",null,u(s.id),1),n("td",null,[n("div",Pe,[l(D,{size:"32",color:"primary",class:"me-2 text-white"},{default:e(()=>[i(u(ce(s.client_name)),1)]),_:2},1024),i(" "+u(s.client_name),1)])]),n("td",null,[l(J,{size:"small",color:Z(s.call_type),class:"text-capitalize"},{default:e(()=>[i(u(s.call_type),1)]),_:2},1032,["color"])]),n("td",null,u(re(s.timestamp)),1),n("td",null,[l(J,{size:"small",color:K(s.status)},{default:e(()=>[i(u(Y(s.status)),1)]),_:2},1032,["color"])]),n("td",null,[l(be,{"model-value":s.success_rate,height:"8",rounded:"",color:fe(s.success_rate)},null,8,["model-value","color"]),n("div",Ie,u(s.success_rate||0)+"% ",1)]),n("td",null,[l(I,{icon:"",size:"small",variant:"text",onClick:H(o=>Q(s.id),["stop"])},{default:e(()=>[l(g,null,{default:e(()=>t[12]||(t[12]=[i("mdi-eye")])),_:1})]),_:2},1032,["onClick"]),l(I,{icon:"",size:"small",variant:"text",onClick:H(o=>ue(s.id),["stop"])},{default:e(()=>[l(g,null,{default:e(()=>t[13]||(t[13]=[i("mdi-download")])),_:1})]),_:2},1032,["onClick"])])],8,Se))),128))])]),_:1})):(m(),h("div",Te,[l(g,{size:"64",color:"grey"},{default:e(()=>t[15]||(t[15]=[i("mdi-message-text-outline")])),_:1}),t[16]||(t[16]=n("h3",{class:"text-h5 mt-4"},"Нет данных",-1)),t[17]||(t[17]=n("p",{class:"text-body-1 mt-2"},"Коммуникации не найдены",-1))]))],64)),v.value.length>0?(m(),V(ze,{key:2})):G("",!0),v.value.length>0?(m(),V(Ce,{key:3},{default:e(()=>[n("span",Ue,u(O.value+1)+"-"+u(A.value)+" из "+u(v.value.length)+" записей ",1),l(W),l(ke,{modelValue:p.value.page,"onUpdate:modelValue":t[4]||(t[4]=s=>p.value.page=s),length:se.value,"total-visible":5},null,8,["modelValue","length"]),l(W),l(B,{modelValue:p.value.itemsPerPage,"onUpdate:modelValue":t[5]||(t[5]=s=>p.value.itemsPerPage=s),label:"Строк на странице",items:[5,10,25,50],variant:"outlined",density:"compact","hide-details":"",class:"pagination-select"},null,8,["modelValue"])]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1}),l(M,{class:"mt-4"},{default:e(()=>[l(f,{cols:"12",md:"4"},{default:e(()=>[l(S,null,{default:e(()=>[l(q,null,{default:e(()=>t[18]||(t[18]=[i("Распределение по типам")])),_:1}),l(P,null,{default:e(()=>[l(E,{density:"compact"},{default:e(()=>[(m(!0),h($,null,j(z.value.typeCounts,(s,o)=>(m(),V(T,{key:o},{prepend:e(()=>[l(D,{size:"32",color:Z(o),class:"text-white"},{default:e(()=>[l(g,{size:"small"},{default:e(()=>[i(u(pe(o)),1)]),_:2},1024)]),_:2},1032,["color"])]),append:e(()=>[n("div",Le,[n("strong",null,u(s),1),n("div",Re," ("+u(Math.round(s/k.value.length*100))+"%) ",1)])]),default:e(()=>[l(U,null,{default:e(()=>[i(u(o),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),l(f,{cols:"12",md:"4"},{default:e(()=>[l(S,null,{default:e(()=>[l(q,null,{default:e(()=>t[19]||(t[19]=[i("Распределение по статусам")])),_:1}),l(P,null,{default:e(()=>[l(E,{density:"compact"},{default:e(()=>[(m(!0),h($,null,j(z.value.statusCounts,(s,o)=>(m(),V(T,{key:o},{prepend:e(()=>[l(D,{size:"32",color:K(o),class:"text-white"},{default:e(()=>[l(g,{size:"small"},{default:e(()=>[i(u(me(o)),1)]),_:2},1024)]),_:2},1032,["color"])]),append:e(()=>[n("div",Fe,[n("strong",null,u(s),1),n("div",$e," ("+u(Math.round(s/k.value.length*100))+"%) ",1)])]),default:e(()=>[l(U,null,{default:e(()=>[i(u(Y(o)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),l(f,{cols:"12",md:"4"},{default:e(()=>[l(S,null,{default:e(()=>[l(q,null,{default:e(()=>t[20]||(t[20]=[i("Средние показатели")])),_:1}),l(P,null,{default:e(()=>[l(E,{density:"compact"},{default:e(()=>[l(T,null,{prepend:e(()=>[l(D,{size:"32",color:"primary",class:"text-white"},{default:e(()=>[l(g,{size:"small"},{default:e(()=>t[21]||(t[21]=[i("mdi-percent")])),_:1})]),_:1})]),append:e(()=>[n("div",Be,[n("strong",null,u(z.value.averageSuccessRate.toFixed(1))+"%",1)])]),default:e(()=>[l(U,null,{default:e(()=>t[22]||(t[22]=[i("Успешность")])),_:1})]),_:1}),l(T,null,{prepend:e(()=>[l(D,{size:"32",color:"primary",class:"text-white"},{default:e(()=>[l(g,{size:"small"},{default:e(()=>t[23]||(t[23]=[i("mdi-clock")])),_:1})]),_:1})]),append:e(()=>[n("div",Ne,[n("strong",null,u(de(z.value.averageDuration)),1)])]),default:e(()=>[l(U,null,{default:e(()=>t[24]||(t[24]=[i("Длительность")])),_:1})]),_:1}),l(T,null,{prepend:e(()=>[l(D,{size:"32",color:"primary",class:"text-white"},{default:e(()=>[l(g,{size:"small"},{default:e(()=>t[25]||(t[25]=[i("mdi-account-multiple")])),_:1})]),_:1})]),append:e(()=>[n("div",Oe,[n("strong",null,u(z.value.uniqueClients),1)])]),default:e(()=>[l(U,null,{default:e(()=>t[26]||(t[26]=[i("Клиентов")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Me,{modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=s=>x.value=s),color:R.value,timeout:3e3},{actions:e(()=>[l(I,{variant:"text",onClick:t[6]||(t[6]=s=>x.value=!1)},{default:e(()=>t[27]||(t[27]=[i("Закрыть")])),_:1})]),default:e(()=>[i(u(L.value)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},ft=Ve(je,[["__scopeId","data-v-77f49d02"]]);export{ft as default};
